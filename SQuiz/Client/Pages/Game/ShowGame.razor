@page "/play/showGame"
@layout PlayerLayout
@using SQuiz.Client.Services
@using SQuiz.Shared.Dtos.Game

@inject ICookieStoreService CookieStoreService
@inject ISessionStorageService SessionStorage
@inject PublicClient Http
@inject NavigationManager Nav

<LoadingWrapper WaitFor="Game">
    <MudAlert Class="pa-3 m-1">You are playing '@Game?.Name'.</MudAlert>
    <MudAlert Severity="Severity.Info" class="pa-3 m-1">Game contains @(Game?.QuestionCount) questions.</MudAlert>
    <MudAlert Severity="Severity.Info" class="pa-3 m-1">When you are ready, press start.</MudAlert>
    <MudButton Color="Color.Primary"
                Variant="Variant.Filled"
                Class="pa-3 m-1"
                @onclick="Start">Start</MudButton>
</LoadingWrapper>

@code {
    public GameOptionDto? Game; 

    protected override async Task OnInitializedAsync()
    {
        var playerId = (await CookieStoreService.GetAsync("playerId"))?.Value;

        if (playerId == null)
        {
            Nav.NavigateTo(Nav.BaseUri);
        }

        Game = await SessionStorage.GetItemAsync<GameOptionDto>("game");
    }

    public async Task Start()
    {
        await CookieStoreService.SetAsync(new Cookie() 
        {
            Name = "questionIndex",
            Value = "0"
        });

        Nav.NavigateTo("play");
    }
}